<!DOCTYPE html>
<html lang="pt-BR"
      xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout(~{::head}, ~{::main})}">
<head>
    <head th:replace="~{fragments/head :: head('Carrinho de Compras')}"></head>
</head>
<main>
    <div class="container mt-5">
        <h1 class="mb-4">üõí Carrinho de Compras</h1>

        <div th:if="${success != null}" class="alert alert-success" role="alert" th:text="${success}"></div>
        <div th:if="${error != null}" class="alert alert-danger" role="alert" th:text="${error}"></div>

        <div th:if="${vendaAtual == null or vendaAtual.itens.isEmpty()}" class="alert alert-info">
            Seu carrinho est√° vazio. Adicione produtos na <a th:href="@{/produto/list}">lista de produtos</a>.
        </div>

        <div th:unless="${vendaAtual == null or vendaAtual.itens.isEmpty()}">

            <table class="table table-striped">
                <thead>
                <tr>
                    <th>Produto</th>
                    <th>Pre√ßo Unit√°rio</th>
                    <th>Quantidade</th>
                    <th>Subtotal</th>
                    <th>A√ß√£o</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${vendaAtual.itens}">
                    <td th:text="${item.produto.descricao}">Produto A</td>
                    <td th:text="${#numbers.formatCurrency(item.produto.valor)}">R$ 10.00</td>
                    <td th:text="${#numbers.formatDecimal(item.quantidade, 1, 2, 'POINT')}">2</td>

                    <td th:with="subtotal=${item.quantidade * item.produto.valor}"
                        th:text="${#numbers.formatCurrency(subtotal)}">R$ 20.00</td>
                    <td>
                        <a th:href="@{/vendas/removerItem/{id}(id=${item.produto.id})}" class="btn btn-sm btn-danger">Remover</a>
                    </td>
                </tr>
                </tbody>
            </table>

            <div class="d-flex justify-content-end mb-4">
                <h4>
                    Total da Venda:
                    <span class="text-primary" th:text="${#numbers.formatCurrency(totalVenda)}">R$ 150,00</span>
                </h4>
            </div>

            <hr/>

            <h3>Finalizar Venda</h3>
            <form th:action="@{/vendas/finalizar}" method="post">

                <div class="mb-3">
                    <label for="cliente" class="form-label">Cliente</label>
                    <select id="cliente" name="clienteId" class="form-select" required>
                        <option value="">Selecione o Cliente</option>
                        <option th:each="cliente : ${clientes}"
                                th:value="${cliente.id}"
                                th:text="${cliente.nome}">Nome do Cliente</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="descricao" class="form-label">Descri√ß√£o da Venda (Opcional)</label>
                    <input type="text" id="descricao" name="descricao" class="form-control" placeholder="Ex: Venda √† vista">
                </div>

                <button type="submit" class="btn btn-success btn-lg">
                    <i class="bi bi-wallet2"></i> Finalizar Compra
                </button>
            </form>

        </div>
    </div>
</main>
</html>